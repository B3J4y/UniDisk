<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:head>
    <meta charset="utf-8"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"></meta>
    <title>UniDisk</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"></link>
    <link rel="stylesheet" href="/assets/css/styles.min.css?h=c1c875adbe3423b81e6840c89217b6d0"></link>


    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>

    <h:outputStylesheet library="css" name="styles.css"  />

</h:head>
<p:importEnum type="de.unidisk.view.variables.ProjectViews" var="Views"/>

<f:metadata>
    <f:viewParam name="projectId" value="#{variablesView.projectId}"
                 required="#{not facesContext.postback}" requiredMessage="Keine Projekt ID gesetzt."/>
    <f:viewParam name="view" value="#{variablesView.view}" converter="projectViewConverter"/>
    <f:viewAction action="#{variablesView.load}" />
    <f:viewAction action="#{projectResultTable.load(variablesView.projectId)}" />
    <f:viewAction action="#{projectTopicTable.setProject(variablesView.projectId)}" />
</f:metadata>

<h:body>

    <h:outputStylesheet library="css" name="styles.css"  />

    <ui:include src="header.xhtml"/>

    <!-- the data table -->
    <div class="row" style="height: 100%;" >
        <div class="col-lg-3 sidebar" id="sidebar">
            <h:panelGroup layout="block" id="sidebar-project-navigation">
                <h2>#{variablesView.projectSelected}</h2>
                <div class="navitem">
                    <p:link outcome="project" value="Themen">
                    <f:param name="projectId" value="#{variablesView.projectId}" />
                    <f:param name="view" value="#{Views.Topics}" />
                    </p:link>
                </div>
                <c:if test="${projectResultTable.hasResults()}">
                <div class="navitem">
                    <p:link outcome="project" value="Ergebnisse">
                    <f:param name="projectId" value="#{variablesView.projectId}" />
                    <f:param name="view" value="#{Views.Results}" />
                    </p:link>
                </div>
                <div class="navitem">
                    <p:link outcome="project" value="Visualisierung">
                        <f:param name="projectId" value="#{variablesView.projectId}" />
                        <f:param name="view" value="#{Views.Visual}" />
                    </p:link>
                </div>
                </c:if>
            </h:panelGroup>
        </div>

        <div class="col-lg-9 content ">

            <c:if test="#{not empty projectResultTable.setupError}">
                <h1 style="text-align: center;padding-top: 20%;">#{projectResultTable.setupError}</h1>
            </c:if>
            <c:if test="#{empty projectResultTable.setupError}">
                <c:if test="#{variablesView.view eq Views.Default or variablesView.view eq Views.Topics}">
                    <h:panelGroup layout="block" id="stichwortPanel" class="row">
                        <div class="col-lg-5 simple-card">

                            <ui:include src="topic_table.xhtml">
                                <ui:param name="updateOnDelete" value="testTable" />
                                <ui:param name="updateOnCreated" value="stichwortPanel" />
                                <ui:param name="updateOnRowSelect" value="testTable projectTopicKeywordsEmpty" />
                                <ui:param name="updateOnRowDeselect" value="testTable projectTopicKeywordsEmpty" />
                            </ui:include>
                        </div>
                        <div class="col-lg-1"></div>
                        <div class="col-lg-5 simple-card">
                            <ui:include src="keyword_table.xhtml">
                                <ui:param name="updateOnDelete" value="testTable" />
                                <ui:param name="updateOnCreated" value="stichwortPanel" />
                                <ui:param name="updateOnRowSelect" value="testTable projectTopicKeywordsEmpty projectTopicHeader" />
                                <ui:param name="updateOnRowDeselect" value="testTable projectTopicKeywordsEmpty projectTopicHeader" />
                            </ui:include>
                        </div>
                    </h:panelGroup>

                    <p>#{projectResultTable.project.processingError}</p>

                </c:if>
                <h:panelGroup id="resultWrapper" rendered="#{variablesView.view eq Views.Results }">
                    <ui:include src="project_results.xhtml" />
                </h:panelGroup>

                <c:if test="#{variablesView.view eq Views.Visual }">
                    <div class="col-lg-2">

                    </div>
                    <a id="image-download" download="map.png"></a>
                    <h:commandButton type="button" id="export-png" value="Export" icon="fa fa-export" style="margin-top:10px;margin-bottom: 10px; margin-left: 15px;">

                    </h:commandButton>


                    <div class="col-lg-10" style="max-height: 80%;">
                        <div id="map" style="height: 500px;width: 100%;"></div>


                    <p:dataTable id="projectResultMapLegend"
                                 emptyMessage="Keine StichwÃ¶rter zugeordnet"
                                 var="item"
                                 value="#{projectResultTable.topics}" scrollable="false" scrollHeight="200">


                        <p:column headerText="Legende" >
                            <input type="checkbox" value="#{item}" checked="checked" onclick="toggleTopic('#{item}')" />
                            <label>#{item}</label>
                        </p:column>

                    </p:dataTable>
                    </div>
                </c:if>
            </c:if>
        </div>
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/bundle.js"></script>
    <script src="js/map.js"></script>
</h:body>
</html>
